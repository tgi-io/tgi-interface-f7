(function(){"use strict";function t(e,r){var i;if(!1==this instanceof t)throw new Error("new operator required");if("string"==typeof e){var n=e;e={},e.name=n,"string"==typeof r&&(e.type=r)}e=e||{},this.name=e.name||null,this.label=e.label||e.name,this.label&&(this.label=this.label.charAt(0).toUpperCase()+this.label.slice(1)),this.type=e.type||"String",i=function(t){var e=t.split("(");return e[1]=parseInt(e[1]),e}(this.type),this.type=i[0],this.hint=e.hint||{},this.validationRule=e.validationRule||{};var o=[],a=["name","type","label","hint","value","validationRule"];switch(this.type){case"ID":o=C(e,a),this.value=e.value||null;break;case"String":o=C(e,a.concat(["placeHolder","quickPick","size"])),this.size=i[1]?i[1]:"number"==typeof e.size?e.size:e.size||50,this.value=e.value||null,e.quickPick&&(this.quickPick=e.quickPick),this.placeHolder=e.placeHolder||null;break;case"Date":o=C(e,a.concat("placeHolder")),this.value=e.value||null,this.placeHolder=e.placeHolder||null;break;case"Boolean":o=C(e,a),this.value=e.value===!1?!1:e.value||null;break;case"Number":o=C(e,a.concat("placeHolder")),this.value=0===e.value?0:e.value||null,this.placeHolder=e.placeHolder||null;break;case"Model":o=C(e,a),this.value=e.value||null,this.value instanceof t.ModelID&&(this.modelType=this.value.modelType);break;case"Group":o=C(e,a),this.value=e.value||null;break;case"Table":o=C(e,a.concat("group")),this.value=e.value||null,this.group=e.group||null;break;case"Object":o=C(e,a),this.value=e.value||null}for(var s=this.getObjectStateErrors(),c=0;c<o.length;c++)s.push("invalid property: "+o[c]);if(s.length>1)throw new Error("error creating Attribute: multiple errors");if(s.length)throw new Error("error creating Attribute: "+s[0]);this._eventListeners=[],this._errorConditions={}}function e(t){if(!1==this instanceof e)throw new Error("new operator required");if("function"==typeof t){var r=t;t={type:"Function",contents:r}}t=t||{};var i,n=C(t,["name","description","type","contents","scope","timeout","theme","icon","bucket"]),o=[];for(i=0;i<n.length;i++)o.push("invalid property: "+n[i]);if(o.length>1)throw new Error("error creating Command: multiple errors");if(o.length)throw new Error("error creating Command: "+o[0]);for(i in t)this[i]=t[i];if(this.name=this.name||"(unnamed)","string"!=typeof this.name)throw new Error("name must be string");if("undefined"==typeof this.description&&(this.description=this.name+" Command"),"undefined"==typeof this.type&&(this.type="Stub"),!E(["Stub","Menu","Presentation","Function","Procedure"],this.type))throw new Error("Invalid command type: "+this.type);switch(this.type){case"Stub":break;case"Menu":if(!(this.contents instanceof Array))throw new Error("contents must be array of menu items");if(!this.contents.length)throw new Error("contents must be array of menu items");for(i in this.contents)if(this.contents.hasOwnProperty(i)&&"string"!=typeof this.contents[i]&&!(this.contents[i]instanceof e))throw new Error("contents must be array of menu items");break;case"Presentation":if(!(this.contents instanceof v))throw new Error("contents must be a Presentation");break;case"Function":if("function"!=typeof this.contents)throw new Error("contents must be a Function");break;case"Procedure":if(!(this.contents instanceof p))throw new Error("contents must be a Procedure");break;default:throw new TypeError}if("undefined"!=typeof this.scope&&!(this.scope instanceof u||this.scope instanceof l))throw new Error("optional scope property must be Model or List");if("undefined"!=typeof this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if("undefined"!=typeof this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if("undefined"!=typeof this.theme){if("string"!=typeof this.theme)throw new Error("invalid theme");if(!E(["default","primary","success","info","warning","danger","link"],this.theme))throw new Error("invalid theme")}if("undefined"!=typeof this.icon){if("string"!=typeof this.icon)throw new Error("invalid icon");if(!E(["fa","glyphicon"],this.icon.split("-")[0])||!this.icon.split("-")[1])throw new Error("invalid icon")}this._eventListeners=[]}function r(e){if(!1==this instanceof r)throw new Error("new operator required");if(!1==e instanceof t.ModelID)throw new Error("Attribute.ModelID required in constructor");this.dateCreated=new Date,this.modelID=e,this.attributeValues={}}function i(t){if(!1==this instanceof i)throw new Error("new operator required");t=t||{},t.name=t.name||"(unnamed)",t.description=t.description||"a Interface",t.vendor=t.vendor||null;var e,r=C(t,["name","description","vendor"]),n=[];for(e=0;e<r.length;e++)n.push("invalid property: "+r[e]);if(n.length>1)throw new Error("error creating Interface: multiple errors");if(n.length)throw new Error("error creating Interface: "+n[0]);this.startCallback=null,this.stopCallback=null,this.mocks=[],this.mockPending=!1;for(e in t)this[e]=t[e]}function n(t,e){if(!1==this instanceof n)throw new Error("new operator required");if("undefined"==typeof t)throw new Error("message type required");if(!E(n.getTypes(),t))throw new Error("Invalid message type: "+t);this.type=t,this.contents=e}function o(t){if(!1==this instanceof o)throw new Error("new operator required");if("string"==typeof t){var r=t;t={},t.type=r}if(t=t||{},this.type=t.type||null,t.value&&(this.value=t.value),!this.type||"string"!=typeof this.type)throw new Error("Request type required");switch(this.type){case"Command":if(this.command=t.command||null,!(this.command instanceof e))throw new Error("command object required")}}function a(t,e){if(!1==this instanceof a)throw new Error("new operator required");if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");var r=this;r.connected=!1,r.initialConnect=!0,r.location=t,""===r.location&&(r.location="http host"),r.socket=io.connect(t,{reconnection:!1}),r.socket.on("connect",function(){r.connected=!0,r.initialConnect=!1,console.log("socket.io ("+r.location+") connected"),e.call(r,new n("Connected",""))}),r.socket.on("connecting",function(){console.log("socket.io ("+r.location+") connecting")}),r.socket.on("error",function(t){var i="general error with "+r.location+(t?", reason "+t:"");console.error(i),r.initialConnect&&e.call(r,new n("Error",i))}),r.socket.on("connect_error",function(t){var i="connect error with "+r.location+(t?", reason "+t:"");console.error(i),r.initialConnect&&e.call(r,new n("Error",i))}),r.socket.on("connect_failed",function(t){var i="connect failed with "+r.location+(t?", reason "+t:"");console.error(i),r.initialConnect&&e.call(r,new n("Error",i))}),r.socket.on("message",function(t){console.log("socket.io ("+r.location+") message: "+t)}),r.socket.on("disconnect",function(t){r.connected=!1,console.log("socket.io ("+r.location+") disconnect: "+t)})}function s(e){if(!1==this instanceof s)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]);var r=new t.ModelID(new g);e.attributes.push(new t({name:"user",type:"Model",value:r})),e.attributes.push(new t({name:"deltas",type:"Object",value:{}})),u.call(this,e),this.modelType="Workspace"}var c=this,h={CORE:function(){return{version:"0.1.0",Application:m,Attribute:t,Command:e,Delta:r,Interface:i,List:l,Log:w,MemoryStore:b,Message:n,Model:u,Presentation:v,Procedure:p,REPLInterface:d,Request:o,Session:y,Store:f,Transport:a,User:g,Workspace:s,inheritPrototype:k,getInvalidProperties:C,trim:M,ltrim:I,rtrim:O,left:q,center:P,right:B,lpad:_,rpad:S,cpad:T,contains:E}}};t.ModelID=function(e){if(!1==this instanceof t.ModelID)throw new Error("new operator required");if(!1==e instanceof u)throw new Error("must be constructed with Model");this.value=e.get("id"),this.constructorFunction=e.constructor,this.modelType=e.modelType},t.ModelID.prototype.toString=function(){return"string"==typeof this.value?"ModelID("+this.modelType+":'"+this.value+"')":"ModelID("+this.modelType+":"+this.value+")"},t.prototype.toString=function(){return null===this.name?"new Attribute":"Attribute: "+this.name},t.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!E(["StateChange","Validate"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},t.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||E(r.events,t))&&r.callback.call(this,t)}},t.prototype.coerce=function(t){var e,r=t;switch(this.type){case"String":return"undefined"==typeof r?"":"boolean"!=typeof r||r?r?(r=t.toString(),r.length>this.size?r.substring(0,this.size):r):"":"false";case"Number":return"undefined"==typeof r?0:r?("string"==typeof r?(r=r.replace(/^\s+|\s+$/g,""),e=r.split(" "),r=e.length?e[0]:"",r=Number(r.replace(/[^/0-9\ \.]+/g,""))):r=Number(r),r?r:0):0;case"Boolean":return"undefined"==typeof r?!1:"string"==typeof r?(r=r.toUpperCase(),"Y"===r||"YES"===r||"T"===r||"TRUE"===r||"1"===r?!0:!1):r?!0:!1;case"Date":return"string"==typeof r&&2==r.split("/").length&&(r=r+"/"+(new Date).getFullYear()),new Date(r)}throw Error("coerce cannot determine appropriate value")},t.prototype.getObjectStateErrors=function(){var e;switch(this.validationErrors=[],this.name||this.validationErrors.push("name required"),E(["ID","String","Date","Boolean","Number","Model","Group","Table","Object"],this.type)||this.validationErrors.push("Invalid type: "+this.type),this.type){case"ID":break;case"String":"number"!=typeof this.size&&this.validationErrors.push("size must be a number from 1 to 255"),(this.size<1||this.size>255)&&this.validationErrors.push("size must be a number from 1 to 255"),null!==this.value&&"string"!=typeof this.value&&this.validationErrors.push("value must be null or a String");break;case"Date":null===this.value||this.value instanceof Date||this.validationErrors.push("value must be null or a Date");break;case"Boolean":null!==this.value&&"boolean"!=typeof this.value&&this.validationErrors.push("value must be null or a Boolean");break;case"Number":null!==this.value&&"number"!=typeof this.value&&this.validationErrors.push("value must be null or a Number");break;case"Model":this.value instanceof t.ModelID||this.validationErrors.push("value must be Attribute.ModelID");break;case"Group":if(null===this.value||this.value instanceof Array)for(e in this.value)this.value.hasOwnProperty(e)&&(this.value[e]instanceof t||this.validationErrors.push("each element in group must be instance of Attribute"),this.value[e].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("value must be null or an array");break;case"Table":if(this.group instanceof t)if(this.group.value instanceof Array)if(this.group.value.length<1)this.validationErrors.push("group property value must contain at least one Attribute");else for(e in this.group.value)this.group.value.hasOwnProperty(e)&&(this.group.value[e]instanceof t||this.validationErrors.push("each element in group must be instance of Attribute"),this.group.value[e].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("group.value must be an array");else this.validationErrors.push("group property required")}var r=C(this.validationRule,["required","range","isOneOf","isValidModel"]);return r.length&&this.validationErrors.push("invalid validationRule: "+r),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},t.prototype.validate=function(t){if("function"!=typeof t)throw new Error("callback is required");this.getObjectStateErrors(),this._emitEvent("Validate");var e;for(e in this._errorConditions)this._errorConditions.hasOwnProperty(e)&&this.validationErrors.push(this._errorConditions[e]);this.validationRule.required&&!this.value&&("Number"==this.type?0!==this.value&&this.validationErrors.push(this.label+" required"):"Boolean"==this.type?this.value!==!1&&this.validationErrors.push(this.label+" required"):this.validationErrors.push(this.label+" required")),this.validationRule.range&&(this.validationRule.range instanceof Array||(this.validationRule.range=[this.validationRule.range]),(this.validationRule.range[0]||0===this.validationRule.range[0])&&this.value<this.validationRule.range[0]&&this.validationErrors.push(this.label+" must be at least "+this.validationRule.range[0]),(this.validationRule.range[1]||0===this.validationRule.range[1])&&this.value>this.validationRule.range[1]&&this.validationErrors.push(this.label+" must be no more than "+this.validationRule.range[1])),this.validationRule.isOneOf&&(this.validationRule.isOneOf instanceof Array||(this.validationRule.isOneOf=[this.validationRule.isOneOf]),-1==this.validationRule.isOneOf.indexOf(this.value)&&this.validationErrors.push(this.label+" invalid")),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this._emitEvent("StateChange"),t.call(this)},t.prototype.setError=function(t,e){if(t=t||"",e=e||"",!t)throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},t.prototype.clearError=function(t){if(t=t||"",!t)throw new Error("condition required");delete this._errorConditions[t]},t.getTypes=function(){return["ID","String","Date","Boolean","Number","Model","Group","Table","Object"].slice(0)},t.getEvents=function(){return["StateChange","Validate"].slice(0)},e.prototype.toString=function(){return this.type+" Command: "+this.name},e.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!E(["BeforeExecute","AfterExecute","Error","Aborted","Completed"],t[r]))throw new Error("Unknown command event: "+t[r]);this._eventListeners.push({events:t,callback:e})},e.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||E(r.events,t))&&r.callback.call(this,t)}},e.prototype.execute=function(){function t(){a.status=0;try{a.contents.apply(a,s)}catch(t){a.error=t,a._emitEvent("Error"),a._emitEvent("Completed"),a.status=-1}}function r(){a.status=0;for(var t=a.contents.tasks||[],r=0;r<t.length;r++){if("function"==typeof t[r]){var o=t[r];t[r]={requires:[-1],command:new e({type:"Function",contents:o})}}t[r].command._parentProcedure||(t[r].command._taskIndex=r,t[r].command._parentProcedure=a,t[r].command.onEvent("*",n)),t[r].command.status=void 0}i()}function i(){for(var t=a.contents.tasks||[],e=0;e<t.length;e++){var r=!0;if("undefined"==typeof t[e].command.status){for(var i in t[e].requires){if("string"==typeof t[e].requires[i])for(var n=0;n<t.length;n++)t[n].label==t[e].requires[i]&&(!t[n].command.status||t[n].command.status<=0)&&(r=!1);if("number"==typeof t[e].requires[i])if(-1==t[e].requires[i])"0"!=e&&(!t[e-1].command.status||t[e-1].command.status<=0)&&(r=!1);else{var o=t[e].requires[i];(!t[o].command.status||t[o].command.status<=0)&&(r=!1)}}r&&t[e].command.execute()}}}function n(t){var e=a.contents.tasks,r=!0;switch(t){case"Error":a._emitEvent("Error");break;case"Completed":for(var n in e)e.hasOwnProperty(n)&&(e[n].command.status&&0!==e[n].command.status||(r=!1));r?a.complete():i()}}if(!this.type)throw new Error("command not implemented");if(!E(["Function","Procedure","Presentation"],this.type))throw new Error("command type "+this.type+" not implemented");var o;switch(this.type){case"Presentation":if(!(this.contents instanceof v))throw new Error("contents must be a Presentation");if(o=this.contents.getObjectStateErrors(),o.length)throw new Error(o.length>1?"error executing Presentation: multiple errors":"error executing Presentation: "+o[0])}var a=this,s=arguments;this._emitEvent("BeforeExecute");try{switch(this.type){case"Function":setTimeout(t,0);break;case"Procedure":setTimeout(r,0)}}catch(c){this.error=c,this._emitEvent("Error"),this._emitEvent("Completed"),this.status=-1}this._emitEvent("AfterExecute")},e.prototype.abort=function(){this._emitEvent("Aborted"),this.status=-1,this._emitEvent("Completed")},e.prototype.complete=function(){this.status=1,this._emitEvent("Completed")},e.getTypes=function(){return["ID","String","Date","Boolean","Number","Model","Group","Table","Object"].slice(0)},e.getEvents=function(){return["BeforeExecute","AfterExecute","Error","Aborted","Completed"].slice(0)},i.prototype.toString=function(){return this.description},i.prototype.canMock=function(){return!0},i.prototype.doMock=function(){var t;if(this.mockPending=!1,!(this.mocks.length<1)){var e=this.mocks.shift();if("ok"==e.type)return void(this.okCallBack?(t=this.okCallBack,delete this.okCallBack,t()):this.okPending=!0);if("yes"==e.type||"no"==e.type)return void(this.yesnoCallBack?(t=this.yesnoCallBack,delete this.yesnoCallBack,t("yes"==e.type)):(this.yesnoPending=!0,this.yesnoResponse="yes"==e.type));if("ask"==e.type)return void(this.askCallBack?(t=this.askCallBack,delete this.askCallBack,t(e.value)):(this.askPending=!0,this.askResponse=e.value));if("choose"==e.type)return void(this.chooseCallBack?(t=this.chooseCallBack,delete this.chooseCallBack,t(i.firstMatch(e.value,this.chooseChoices))):(this.choosePending=!0,this.chooseResponse=e.value));this.dispatch(e),this.mockPending=!0;var r=this;setTimeout(function(){r.doMock()},0)}},i.prototype.mockRequest=function(t){if(!(t instanceof Array||t instanceof o))throw new Error("missing request parameter");t instanceof Array||(t=[t]);var e;for(e=0;e<t.length;e++)if(!1==t[e]instanceof o)throw new Error("invalid request parameter");for(e=0;e<t.length;e++)this.mocks.push(t[e]);this.mockPending||this.doMock()},i.prototype.start=function(t,e,r){if(!(t instanceof m))throw new Error("Application required");if(!(e instanceof v))throw new Error("presentation required");if("function"!=typeof r)throw new Error("callBack required");this.application=t,this.presentation=e,this.startCallback=r},i.prototype.stop=function(t){if("function"!=typeof t)throw new Error("callBack required")},i.prototype.dispatch=function(t,e){if(!1==t instanceof o)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");this.application&&this.application.dispatch(t)||this.startCallback&&this.startCallback(t)},i.prototype.notify=function(t){if(!1==t instanceof n)throw new Error("Message required")},i.prototype.render=function(t,e){if(!1==t instanceof v)throw new Error("Presentation object required");if(e&&"function"!=typeof e)throw new Error("optional second argument must a commandRequest callback function")},i.prototype.info=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},i.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callBack required");this.okPending?(delete this.okPending,e()):this.okCallBack=e},i.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callBack required");this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):this.yesnoCallBack=e},i.prototype.ask=function(e,r,i){if(!e||"string"!=typeof e)throw new Error("prompt required");if(!1==r instanceof t)throw new Error("instance of Attribute a required parameter");if("function"!=typeof i)throw new Error("callBack required");this.askPending?(delete this.askPending,i(this.askResponse)):this.askCallBack=i},i.prototype.choose=function(t,e,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callBack required");this.choosePending?(delete this.choosePending,r(i.firstMatch(this.chooseResponse,e))):(this.chooseCallBack=r,this.chooseChoices=e)},i.firstMatch=function(t,e){if(void 0===t)return void 0;for(var r=0;r<e.length;r++){var i=e[r].toLowerCase();if(q(i,t.length)==t.toLowerCase())return r}return void 0};var l=function(t){if(!1==this instanceof l)throw new Error("new operator required");if(!1==t instanceof u)throw new Error("argument required: model");this.model=t,this._items=[],this._itemIndex=-1};l.prototype.length=function(){return this._items.length},l.prototype.clear=function(){return this._items=[],this._itemIndex=-1,this},l.prototype.get=function(t){if(this._items.length<1)throw new Error("list is empty");for(var e=0;e<this.model.attributes.length;e++)if(this.model.attributes[e].name.toUpperCase()==t.toUpperCase())return this._items[this._itemIndex][e]},l.prototype.set=function(t,e){if(this._items.length<1)throw new Error("list is empty");for(var r=0;r<this.model.attributes.length;r++)if(this.model.attributes[r].name.toUpperCase()==t.toUpperCase())return void(this._items[this._itemIndex][r]=e);throw new Error("attribute not valid for list model")},l.prototype.addItem=function(t){var e,r=[];if(t)for(e in t.attributes)r.push(t.attributes[e].value);else for(e in this.model.attributes)r.push(void 0);return this._items.push(r),this._itemIndex=this._items.length-1,this},l.prototype.removeItem=function(){return this._items.splice(this._itemIndex,1),this._itemIndex--,this},l.prototype.indexedItem=function(t){return this._items.length<1?!1:0>t?!1:t>=this._items.length?!1:(this._itemIndex=t,!0)},l.prototype.moveNext=function(){return this._items.length<1?!1:this.indexedItem(this._itemIndex+1)},l.prototype.movePrevious=function(){return this._items.length<1?!1:this.indexedItem(this._itemIndex-1)},l.prototype.moveFirst=function(){return this._items.length<1?!1:this.indexedItem(0)},l.prototype.moveLast=function(){return this._items.length<1?!1:this.indexedItem(this._items.length-1)},l.prototype.sort=function(t){var e,r=0;for(var i in t)e||(e=i);if(!e)throw new Error("sort order required");for(var n=1==t[e];r<this.model.attributes.length&&this.model.attributes[r].name!=e;)r++;this._items.sort(function(t,e){if(n){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}else{if(t[r]>e[r])return-1;if(t[r]<e[r])return 1}return 0})};var u=function(e){var r;if(!1==this instanceof u)throw new Error("new operator required");if(this.modelType="Model",this.attributes=[new t("id","ID")],e=e||{},e.attributes)for(r in e.attributes)e.attributes.hasOwnProperty(r)&&this.attributes.push(e.attributes[r]);var i=C(e,["attributes"]),n=this.getObjectStateErrors();for(r=0;r<i.length;r++)n.push("invalid property: "+i[r]);if(n.length>1)throw new Error("error creating Model: multiple errors");if(n.length)throw new Error("error creating Model: "+n[0]);this._eventListeners=[],this._errorConditions={}};u.prototype.toString=function(){return"a "+this.modelType},u.prototype.copy=function(t){for(var e=0;e<this.attributes.length;e++)this.attributes[e].value=t.attributes[e].value},u.prototype.getObjectStateErrors=function(){if(this.validationErrors=[],this.attributes instanceof Array)if(this.attributes.length<1)this.validationErrors.push("attributes must not be empty");else for(var e=0;e<this.attributes.length;e++)0!==e||this.attributes[e]instanceof t&&"ID"==this.attributes[e].type||this.validationErrors.push("first attribute must be ID"),this.attributes[e]instanceof t||this.validationErrors.push("attribute must be Attribute");else this.validationErrors.push("attributes must be Array");return void 0===this.tags||this.tags instanceof Array||this.validationErrors.push("tags must be Array or null"),this.validationErrors},u.prototype.get=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].value},u.prototype.getAttributeType=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].type},u.prototype.set=function(t,e){for(var r=0;r<this.attributes.length;r++)if(this.attributes[r].name.toUpperCase()==t.toUpperCase())return void(this.attributes[r].value=e);throw new Error("attribute not valid for model")},u.prototype.validate=function(t){var e,r,i=this,n=0;if("function"!=typeof t)throw new Error("callback is required");i.getObjectStateErrors();for(r in i._errorConditions)i._errorConditions.hasOwnProperty(r)&&i.validationErrors.push(i._errorConditions[r]);if(i.validationErrors.length)return i.validationMessage=i.validationErrors.length>0?i.validationErrors[0]:"",i._emitEvent("StateChange"),void t.call(i);for(e=0;e<i.attributes.length;e++)n++,function(e){setTimeout(function(){e.validate(function(){e.validationErrors.length&&i.validationErrors.push("bush"),0===--n&&(i.validationErrors.length||i._emitEvent("Validate"),i.validationMessage=i.validationErrors.length>0?i.validationErrors[0]:"",i._emitEvent("StateChange"),t.call(i))})},0)}(i.attributes[e])},u.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!E(["StateChange","Validate"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},u.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||E(r.events,t))&&r.callback.call(this,t)}},u.prototype.setError=function(t,e){if(t=t||"",e=e||"",!t)throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},u.prototype.clearError=function(t){if(t=t||"",!t)throw new Error("condition required");delete this._errorConditions[t]},n.prototype.toString=function(){switch(this.type){case"Null":return this.type+" Message";default:return this.type+" Message: "+this.contents}},n.getTypes=function(){return["Null","Connected","Error","Sent","Ping","PutModel","PutModelAck","GetModel","GetModelAck","DeleteModel","DeleteModelAck","GetList","GetListAck"].slice(0)};var p=function(t){if(!1==this instanceof p)throw new Error("new operator required");t=t||{};var e,r=C(t,["tasks","tasksNeeded","tasksCompleted"]),i=[];for(e=0;e<r.length;e++)i.push("invalid property: "+r[e]);if(i.length>1)throw new Error("error creating Procedure: multiple errors");if(i.length)throw new Error("error creating Procedure: "+i[0]);for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);if(i=this.getObjectStateErrors()){if(i.length>1)throw new Error("error creating Procedure: multiple errors");if(i.length)throw new Error("error creating Procedure: "+i[0])}};p.prototype.getObjectStateErrors=function(){var t,r,i,n;if(this.tasks&&!(this.tasks instanceof Array))return["tasks is not an array"];var o=[];for(t in this.tasks)if(this.tasks.hasOwnProperty(t)){var a=this.tasks[t];for(n=C(a,["label","command","requires","timeout"]),r=0;r<n.length;r++)o.push("invalid task["+t+"] property: "+n[r]);"undefined"!=typeof a.label&&"string"!=typeof a.label&&o.push("task["+t+"].label must be string"),"undefined"==typeof a.command||a.command instanceof e||o.push("task["+t+"].command must be a Command object"),"undefined"==typeof a.requires&&(a.requires=-1),a.requires instanceof Array||(a.requires=[a.requires]);for(r in a.requires)if(a.requires.hasOwnProperty(r)&&null!==a.requires[r])switch(typeof a.requires[r]){case"string":var s=!1;for(i=0;!s&&i<this.tasks.length;i++)a.requires[r]==this.tasks[i].label&&(s=!0);if(!s)throw new Error("missing label: "+a.requires[r]);break;case"number":if(a.requires[r]>=this.tasks.length)throw new Error("missing task #"+a.requires[r]+" for requires in task["+t+"]");if(a.requires[r]<-1)throw new Error("task #"+a.requires[r]+" invalid requires in task["+t+"]");break;default:throw new Error("invalid type for requires in task["+t+"]")}}return o.length?o:null},o.prototype.toString=function(){switch(this.type){case"Command":return this.type+" Request: "+this.command;default:return this.type+" Request"}};var f=function(t){if(!1==this instanceof f)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"Store",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!1,canGetModel:!1,canPutModel:!1,canDeleteModel:!1,canGetList:!1};for(var e=C(t,["name","storeType"]),r=[],i=0;i<e.length;i++)r.push("invalid property: "+e[i]);if(r.length>1)throw new Error("error creating Store: multiple errors");if(r.length)throw new Error("error creating Store: "+r[0])};f.prototype.toString=function(){return this.name=="a "+this.storeType?this.name:this.storeType+": "+this.name},f.prototype.getServices=function(){return this.storeProperty},f.prototype.onConnect=function(t,e){if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");e(this,void 0)},f.prototype.getModel=function(){throw new Error(this.storeType+" does not provide getModel")},f.prototype.putModel=function(){throw new Error("Store does not provide putModel")},f.prototype.deleteModel=function(){throw new Error("Store does not provide deleteModel")},f.prototype.getList=function(){throw new Error("Store does not provide getList")},a.messageHandlers={},a.setMessageHandler=function(t,e){a.messageHandlers[t]=e},a.hostMessageProcess=function(t,e){a.messageHandlers[t.type]?a.messageHandlers[t.type](t.contents,e):e(!0)},a.prototype.send=function(t,e){var r=this;if("undefined"==typeof t)throw new Error("message required");if(!(t instanceof n))throw new Error("parameter must be instance of Message");if("undefined"!=typeof e&&"function"!=typeof e)throw new Error("argument must a callback");return this.connected?void("undefined"!=typeof e?r.socket.emit("ackmessage",t,function(t){e.call(r,t)}):r.socket.send(t)):void e.call(r,new n("Error","not connected"))},a.prototype.close=function(){if(!this.connected)throw new Error("not connected");this.socket.disconnect()};var d=function(t){if(!1==this instanceof i)throw new Error("new operator required");t=t||{},t.name=t.name||"(unnamed)",t.description=t.description||"a REPLInterface",t.vendor=t.vendor||null;var e,r=C(t,["name","description","vendor"]),n=[];for(e=0;e<r.length;e++)n.push("invalid property: "+r[e]);if(n.length>1)throw new Error("error creating Interface: multiple errors");if(n.length)throw new Error("error creating Interface: "+n[0]);this.startCallback=null,this.stopCallback=null,this.mocks=[],this.mockPending=!1;for(e in t)this[e]=t[e]};d.prototype=Object.create(i.prototype),d.prototype.toString=function(){return this.description},d.prototype.canMock=function(){return!0},d.prototype.doMock=function(){var t;if(this.mockPending=!1,!(this.mocks.length<1)){var e=this.mocks.shift();if("ok"==e.type)return void(this.okCallBack?(t=this.okCallBack,delete this.okCallBack,t()):this.okPending=!0);if("yes"==e.type||"no"==e.type)return void(this.yesnoCallBack?(t=this.yesnoCallBack,delete this.yesnoCallBack,t("yes"==e.type)):(this.yesnoPending=!0,this.yesnoResponse="yes"==e.type));if("ask"==e.type)return void(this.askCallBack?(t=this.askCallBack,delete this.askCallBack,t(e.value)):(this.askPending=!0,this.askResponse=e.value));if("choose"==e.type)return void(this.chooseCallBack?(t=this.chooseCallBack,delete this.chooseCallBack,t(i.firstMatch(e.value,this.chooseChoices))):(this.choosePending=!0,this.chooseResponse=e.value));this.dispatch(e),this.mockPending=!0;var r=this;setTimeout(function(){r.doMock()},0)}},d.prototype.mockRequest=function(t){if(!(t instanceof Array||t instanceof o))throw new Error("missing request parameter");t instanceof Array||(t=[t]);var e;for(e=0;e<t.length;e++)if(!1==t[e]instanceof o)throw new Error("invalid request parameter");
for(e=0;e<t.length;e++)this.mocks.push(t[e]);this.mockPending||this.doMock()},d.prototype.start=function(t,e,r){if(!(t instanceof m))throw new Error("Application required");if(!(e instanceof v))throw new Error("presentation required");if("function"!=typeof r)throw new Error("callBack required");this.application=t,this.presentation=e,this.startCallback=r},d.prototype.stop=function(t){if("function"!=typeof t)throw new Error("callBack required")},d.prototype.dispatch=function(t,e){if(!1==t instanceof o)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");this.application&&this.application.dispatch(t)||this.startCallback&&this.startCallback(t)},d.prototype.notify=function(t){if(!1==t instanceof n)throw new Error("Message required");this.captureOutputCallback&&this.captureOutputCallback(t)},d.prototype.render=function(t,e){if(!1==t instanceof v)throw new Error("Presentation object required");if(e&&"function"!=typeof e)throw new Error("optional second argument must a commandRequest callback function")},d.prototype.info=function(t){if(!t||"string"!=typeof t)throw new Error("text required");this.captureOutputCallback&&this.captureOutputCallback(t)},d.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callBack required");this.captureOutputCallback&&this.captureOutputCallback(t),this.okPending?(delete this.okPending,e()):this.okCallBack=e},d.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callBack required");this.captureOutputCallback&&this.captureOutputCallback(t),this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):this.yesnoCallBack=e},d.prototype.ask=function(e,r,i){if(!e||"string"!=typeof e)throw new Error("prompt required");if(!1==r instanceof t)throw new Error("instance of Attribute a required parameter");if("function"!=typeof i)throw new Error("callBack required");this.captureOutputCallback&&this.captureOutputCallback(e),this.askPending?(delete this.askPending,i(this.askResponse)):this.askCallBack=i},d.prototype.choose=function(t,e,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callBack required");if(this.captureOutputCallback){this.captureOutputCallback(t);for(var n=0;n<e.length;n++)this.captureOutputCallback("  "+e[n])}this.choosePending?(delete this.choosePending,r(i.firstMatch(this.chooseResponse,e))):(this.chooseCallBack=r,this.chooseChoices=e)},d.prototype.evaluateInput=function(t){var r,n=(""+t).toUpperCase();if(this.okCallBack)return r=this.okCallBack,delete this.okCallBack,void r();if(this.yesnoCallBack)return r=this.yesnoCallBack,delete this.yesnoCallBack,void r("Y"==n||"YES"==n);if(this.askCallBack)return r=this.askCallBack,delete this.askCallBack,void r(t);if(this.chooseCallBack)return r=this.chooseCallBack,delete this.chooseCallBack,void r(i.firstMatch(t,this.chooseChoices));if(this.presentation&&t.length){for(var o=this.presentation.get("contents"),a="",s=0;s<o.length;s++){var c=o[s];if(c instanceof e){var h=c.name.toUpperCase();if(q(h,n.length)==n)return void c.execute();a+=" "+c.name}}return void(this.captureOutputCallback&&(this.captureOutputCallback("unrecognized: "+t),this.captureOutputCallback("valid commands: "+a)))}this.captureOutputCallback&&this.captureOutputCallback("input ignored: "+t)},d.prototype.captureOutput=function(t){this.captureOutputCallback=t};var m=function(e){if(!1==this instanceof m)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]),e.attributes.push(new t({name:"name",type:"String(20)"})),e.attributes.push(new t({name:"brand",type:"String"})),e["interface"]&&(this.setInterface(e["interface"]),delete e["interface"]),u.call(this,e),this.modelType="Application",this.set("name","newApp"),this.set("brand","NEW APP")};m.prototype=Object.create(u.prototype),m.prototype.start=function(t){if(!1==this.primaryInterface instanceof i)throw new Error("error starting application: interface not set");if("function"!=typeof t)throw new Error("callBack required");var e=this;this.startCallback=t,this.presentation||(this.presentation=new v),this.primaryInterface.start(e,this.presentation,function(t){"Command"==t.type?t.command.execute():e.startCallback&&e.startCallback(t)})},m.prototype.dispatch=function(t,e){if(!1==t instanceof o)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");return"Command"==t.type?(t.command.execute(),!0):this.startCallback?(this.startCallback(t),!0):!1},m.prototype.setInterface=function(t){if(!1==t instanceof i)throw new Error("instance of Interface a required parameter");this.primaryInterface=t},m.prototype.getInterface=function(){return this.primaryInterface},m.prototype.setPresentation=function(t){if(!1==t instanceof v)throw new Error("instance of Presentation a required parameter");this.presentation=t},m.prototype.getPresentation=function(){return this.presentation},m.prototype.info=function(t){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.info(t)},m.prototype.ok=function(t,e){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callBack required");this.primaryInterface.ok(t,e)},m.prototype.yesno=function(t,e){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callBack required");this.primaryInterface.yesno(t,e)},m.prototype.ask=function(e,r,n){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!e||"string"!=typeof e)throw new Error("prompt required");if(!1==r instanceof t)throw new Error("instance of Attribute a required parameter");if("function"!=typeof n)throw new Error("callBack required");this.primaryInterface.ask(e,r,n)},m.prototype.choose=function(t,e,r){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callBack required");this.primaryInterface.choose(t,e,r)};var w=function(e){if(!1==this instanceof w)throw new Error("new operator required");if("string"==typeof e){var r=e;e={},e.contents=r}e=e||{},e.attributes||(e.attributes=[]);var i=e.logType||"Text",n=e.importance||"Info",o=e.contents||"(no text)";if(!E(["Text","Delta"],i))throw new Error("Unknown log type: "+i);"undefined"!=typeof e.logType&&delete e.logType,"undefined"!=typeof e.importance&&delete e.importance,"undefined"!=typeof e.contents&&delete e.contents,e.attributes.push(new t({name:"dateLogged",type:"Date",value:new Date})),e.attributes.push(new t({name:"logType",type:"String",value:i})),e.attributes.push(new t({name:"importance",type:"String",value:n})),e.attributes.push("Delta"==i?new t({name:"contents",type:"Object",value:o}):new t({name:"contents",type:"String",value:o})),u.call(this,e),this.modelType="Log"};w.prototype=Object.create(u.prototype),w.prototype.toString=function(){return"Delta"==this.get("logType")?this.get("importance")+": (delta)":this.get("importance")+": "+this.get("contents")};var v=function(e){if(!1==this instanceof v)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]),e.attributes.push(new t({name:"name",type:"String"})),e.attributes.push(new t({name:"modelName",type:"String"})),e.attributes.push(new t({name:"contents",type:"Object",value:[]})),u.call(this,e),this.modelType="Presentation"};v.prototype=Object.create(u.prototype),v.prototype.getObjectStateErrors=function(r){var i;if(this.validationErrors=u.prototype.getObjectStateErrors.call(this),!r&&0===this.validationErrors.length){var n=this.get("contents"),o=!1;if(n instanceof Array){for(i=0;i<n.length;i++)n[i]instanceof e||n[i]instanceof t||"string"==typeof n[i]||(o=!0);o&&this.validationErrors.push("contents elements must be Command, Attribute or string")}else this.validationErrors.push("contents must be Array")}return this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},v.prototype.validate=function(e){function r(){c++,this.validationMessage&&(a=!0),c==c&&(a&&i.validationErrors.push("contents has validation errors"),i.validationMessage=i.validationErrors.length>0?i.validationErrors[0]:"",e())}var i=this;if("function"!=typeof e)throw new Error("callback is required");this.getObjectStateErrors();var n;for(n in this._errorConditions)this._errorConditions.hasOwnProperty(n)&&this.validationErrors.push(this._errorConditions[n]);var o,a=!1,s=0,c=0,h=this.get("contents");if(h instanceof Array){for(o=0;o<h.length;o++)h[o]instanceof t&&s++;for(o=0;o<h.length;o++)h[o]instanceof t&&h[o].validate(r)}};var y=function(e){if(!1==this instanceof y)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]);var r=new t.ModelID(new g);e.attributes.push(new t({name:"userID",type:"Model",value:r})),e.attributes.push(new t({name:"dateStarted",type:"Date",value:new Date})),e.attributes.push(new t({name:"passCode",type:"String(20)"})),e.attributes.push(new t({name:"active",type:"Boolean"})),e.attributes.push(new t({name:"ipAddress",type:"String"})),u.call(this,e),this.modelType="Session",this.set("active",!1)};y.prototype=Object.create(u.prototype),y.prototype.startSession=function(t,e,r,i,n){if(!1==t instanceof f)throw new Error("store required");if("string"!=typeof e)throw new Error("userName required");if("string"!=typeof r)throw new Error("password required");if("string"!=typeof i)throw new Error("ip required");if("function"!=typeof n)throw new Error("callBack required");var o=this,a=new g;t.getList(new l(a),{name:e,password:r},function(e,r){if(r)return void n(r);if(1!=e.length())return void n(new Error("login not found"));for(var a="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;20>c;c++)a+=s.charAt(Math.floor(Math.random()*s.length));e.moveFirst(),o.set("userID",e.get("id")),o.set("active",!0),o.set("passCode",a),o.set("ipAddress",i),t.putModel(o,function(t,e){n(e,t)})})},y.prototype.resumeSession=function(t,e,r,i){if(!1==t instanceof f)throw new Error("store required");if("string"!=typeof e)throw new Error("ip required");if("string"!=typeof r)throw new Error("passCode required");if("function"!=typeof i)throw new Error("callBack required");var n=this;t.getList(new l(n),{ipAddress:e,passCode:r},function(t,e){return e?void i(e):1!=t.length()?void i(new Error("session not resumed")):(t.moveFirst(),n.set("id",t.get("id")),n.set("userID",t.get("userID")),n.set("dateStarted",t.get("dateStarted")),n.set("passCode",t.get("passCode")),n.set("active",t.get("active")),n.set("ipAddress",t.get("ipAddress")),void i(e,n))})},y.prototype.endSession=function(t,e){if(!1==t instanceof f)throw new Error("store required");if("function"!=typeof e)throw new Error("callBack required");this.get("active")&&this.get("id")||e(this),this.set("active",!1),t.putModel(this,function(t,r){e(r,t)})};var g=function(e){if(!1==this instanceof g)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]),e.attributes.push(new t({name:"name",type:"String(20)"})),e.attributes.push(new t({name:"active",type:"Boolean"})),e.attributes.push(new t({name:"password",type:"String(20)"})),e.attributes.push(new t({name:"firstName",type:"String(35)"})),e.attributes.push(new t({name:"lastName",type:"String(35)"})),e.attributes.push(new t({name:"email",type:"String(20)"})),u.call(this,e),this.modelType="User",this.set("active",!1)};g.prototype=Object.create(u.prototype),s.prototype=Object.create(u.prototype);var b=function(t){if(!1==this instanceof b)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"MemoryStore",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!0,canGetModel:!0,canPutModel:!0,canDeleteModel:!0,canGetList:!0},this.data=[],this.idCounter=0;for(var e=C(t,["name","storeType"]),r=[],i=0;i<e.length;i++)r.push("invalid property: "+e[i]);if(r.length>1)throw new Error("error creating Store: multiple errors");if(r.length)throw new Error("error creating Store: "+r[0])};b.prototype=Object.create(f.prototype),b.prototype.getModel=function(t,e){var r,i;if(!(t instanceof u))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if(!t.attributes[0].value)throw new Error("ID not set");if("function"!=typeof e)throw new Error("callBack required");var n=-1;for(r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(n=r);if(0>n)return void e(t,new Error("model not found in store"));var o=t.get("id"),a=this.data[n][1],s=-1;for(r=0;0>s&&r<a.length;r++)a[r][0]==o&&(s=r);if(0>s)return void e(t,new Error("id not found in store"));var c=a[s][1];for(i in t.attributes)t.attributes[i].value=c[t.attributes[i].name];e(t,void 0)},b.prototype.putModel=function(t,e){var r,i,n,o,a,s,c;if(!(t instanceof u))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callBack required");if(n=t.get("ID")){for(o=-1,r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(o=r);if(0>o)return void e(t,new Error("model not found in store"));var h=-1;n=t.get("id");var l=this.data[o][1];for(r=0;0>h&&r<l.length;r++)l[r][0]==n&&(h=r);if(0>h)return void e(t,new Error("id not found in store"));a={};for(i in t.attributes)s=t.attributes[i].name,c=t.attributes[i].value,a[s]=c;l[h][1]=a,e(t,void 0)}else{for(o=-1,r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(o=r);0>o&&(this.data.push([t.modelType,[]]),o=this.data.length-1);var p=++this.idCounter;t.set("id",p),a={};for(i in t.attributes)s=t.attributes[i].name,c=t.attributes[i].value,a[s]=c;this.data[o][1].push([p,a]),e(t,void 0)}},b.prototype.deleteModel=function(t,e){var r,i;if(!(t instanceof u))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callBack required");var n=-1;for(r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(n=r);if(0>n)return void e(t,new Error("model not found in store"));var o=-1,a=t.get("id"),s=this.data[n][1];for(r=0;0>o&&r<s.length;r++)s[r][0]==a&&(o=r);if(0>o)return void e(t,new Error("id not found in store"));var c=s.splice(o,1)[0][1];for(i in t.attributes)t.attributes[i].value="id"==t.attributes[i].name?void 0:c[t.attributes[i].name];e(t,void 0)},b.prototype.getList=function(t,e,r,i){var n,o,a;if("function"==typeof i?(n=i,o=r):n=r,!(t instanceof l))throw new Error("argument must be a List");if(!(e instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof n)throw new Error("callBack required");var s=-1;for(a=0;a<this.data.length;a++)this.data[a][0]==t.model.modelType&&(s=a);if(0>s)return void n(t);t.clear();var c=this.data[s][1];for(a=0;a<c.length;a++){var h=!0;for(var u in e)e.hasOwnProperty(u)&&(e[u]instanceof RegExp?e[u].test(c[a][1][u])||(h=!1):e[u]!=c[a][1][u]&&(h=!1));if(h){var p=[];for(var f in c[a][1])p.push(c[a][1][f]);t._items.push(p)}}t._itemIndex=t._items.length-1,o&&t.sort(o),n(t)};var E=function(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1},k=function(t){function e(){}if(null===t)throw new TypeError;if(Object.create)return Object.create(t);var r=typeof t;if("object"!==r&&"function"!=typeof r)throw new TypeError;return e.prototype=t,new e},C=function(t,e){var r=[];for(var i in t)t.hasOwnProperty(i)&&(E(e,i)||r.push(i));return r},q=function(t,e){return t.substring(0,e)},B=function(t,e){return t.substring(t.length-e,t.length)},P=function(t,e){var r=(t.length-e)/2;return t.substring(r,r+e)},M=function(t){return t.replace(/^\s+|\s+$/g,"")},I=function(t){return t.replace(/^\s+/,"")},O=function(t){return t.replace(/\s+$/,"")},_=function(t,e,r){r=r||" ";var i=""+t;if(i.length>e)return q(i,e);for(;i.length<e;)i=r+i;return i},S=function(t,e,r){r=r||" ";var i=""+t;if(i.length>e)return B(i,e);for(;i.length<e;)i+=r;return i},T=function(t,e,r){r=r||" ";var i=""+t,n=e-i.length;if(i.length>e)return P(i,e);var o=i.length+Math.floor(n/2);return i=_(i,o,r),i=S(i,e,r)};h.INTERFACE=h.INTERFACE||{},h.INTERFACE.FRAMEWORK7=function(){return{version:"0.0.1",Framework7Interface:A}};var A=function(t){if(!1==this instanceof i)throw new Error("new operator required");t=t||{},t.name=t.name||"(unnamed)",t.description=t.description||"a Framework7Interface",t.vendor=t.vendor||null;var e,r=C(t,["name","description","vendor"]),n=[];for(e=0;e<r.length;e++)n.push("invalid property: "+r[e]);if(n.length>1)throw new Error("error creating Interface: multiple errors");if(n.length)throw new Error("error creating Interface: "+n[0]);this.startCallback=null,this.stopCallback=null,this.mocks=[],this.mockPending=!1;for(e in t)this[e]=t[e]};A.prototype=Object.create(i.prototype),A.prototype.canMock=function(){return this.vendor?!0:!1},A.prototype.start=function(t,e,r){if(!(t instanceof m))throw new Error("Application required");if(!(e instanceof v))throw new Error("presentation required");if("function"!=typeof r)throw new Error("callBack required");if(this.application=t,this.presentation=e,this.startCallback=r,!this.vendor)throw new Error("Error initializing Framework7");try{A._f7||(A._f7=new this.vendor)}catch(i){throw new Error("Error initializing Framework7: "+i)}this.doc={},this.presentation.get("contents").length&&this.htmlNavigation(),this.htmlViews()},A.addEle=function(t,e,r,i){var n=document.createElement(e);if(r&&r.length&&(n.className=r),i)for(var o in i)i.hasOwnProperty(o)&&n.setAttribute(o,i[o]);return t.appendChild(n),n},A.prototype.htmlNavigation=function(){var t=A.addEle;document.body.innerHTML='<div class="statusbar-overlay"></div><div class="panel-overlay"></div>',this.views=t(document.body,"div","views",{id:"views"}),this.viewMain=t(this.views,"div","view view-main",{id:"viewMain"}),this.navBar=t(this.viewMain,"div","navbar",{id:"navBar"}),this.navBarInner=t(this.navBar,"div","navbar-inner",{id:"navBarInner"}),this.leftOfBrand=t(this.navBarInner,"div","left"),this.brand=t(this.navBarInner,"div","center",{id:"brand"}),this.rightOfBrand=t(this.navBarInner,"div","right"),this.brand.innerText=this.application.get("brand"),this.toolBar=t(this.viewMain,"div","toolbar tabbar tabbar-labels",{id:"toolBar"}),this.toolBarInner=t(this.toolBar,"div","toolbar-inner",{id:"toolBarInner"}),this.refreshToolbar()},A.prototype.refreshToolbar=function(){function t(t){var e={command:t,domElement:null,id:null,primaryView:null,subMenu:[]};i.toolBarCommands.push(e),e.id="tbLink"+i.toolBarCommands.length,e.domElement=n(i.toolBarInner,"a","tab-link",{id:e.id,href:"#"}),e.domElement.innerHTML='<i class="fa '+(t.icon||"fa-circle-thin")+' fa-lg"></i><span class="tabbar-label">'+t.name+"</span>",o("#"+e.id).on("click",function(){var t=o(this).attr("id"),e=parseInt(B(t,t.length-6))-1;r(i.toolBarCommands[e])})}function r(t){var e=t.command;switch(e.type){case"Procedure":e.execute();break;case"Menu":i.showView(t);break;case"Stub":i.application.ok("This feature is not available.",function(){});break;default:i.application.ok("Sorry can't handle that command type yet\n\n"+JSON.stringify(e.type),function(){})}}var i=this,n=A.addEle,o=Dom7;i.toolBarInner.innerHTML="",i.toolBarCommands=[];var a=i.presentation.get("contents"),s=0;for(var c in a)a.hasOwnProperty(c)&&"string"!=typeof a[c]&&s++;var h=6,l=64;i.toolBar.clientWidth>400&&(l=96),i.toolBar.clientWidth>768&&(l=112),i.toolBar.clientWidth&&(h=Math.floor(i.toolBar.clientWidth/l));var u=s>h,p=u?h:s,f=0;for(c in a)if(a.hasOwnProperty(c)&&"string"!=typeof a[c]&&(t(a[c]),++f>=p))break;u&&t(new e({name:"more",icon:"fa-ellipsis-h"}))},A.prototype.highlightToolBarCommand=function(t){for(var e=Dom7,r=0;r<this.toolBarCommands.length;r++){var i=this.toolBarCommands[r];e(i.domElement).removeClass("active")}e(t.domElement).addClass("active")},A.prototype.updateBrand=function(t){this.brand.innerText=t},A.prototype.info=function(t){if(!t||"string"!=typeof t)throw new Error("text required");A._f7.addNotification({title:this.application.get("brand"),message:t,hold:3e3})},A.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callBack required");this.okPending?(delete this.okPending,e()):A._f7.alert(t.replace(/\n/g,"<br>"),this.application.get("brand"),function(){e()})},A.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callBack required");this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):A._f7.modal({text:t.replace(/\n/g,"<br>"),title:this.application.get("brand"),verticalButtons:!0,buttons:[{text:"Yes",onClick:function(){e(!0)}},{text:"No",onClick:function(){e(!1)}}]})},A.prototype.ask=function(e,r,i){if(!e||"string"!=typeof e)throw new Error("prompt required");if(!1==r instanceof t)throw new Error("instance of Attribute a required parameter");if("function"!=typeof i)throw new Error("callBack required");this.askPending?(delete this.askPending,i(this.askResponse)):A._f7.prompt(e.replace(/\n/g,"<br>"),this.application.get("brand"),function(t){i(t)},function(){i()})},A.prototype.choose=function(t,e,r){function n(){r()}function o(){r(e[0])}function a(){r(e[1])}function s(){r(e[2])}function c(){r(e[3])}function h(){r(e[4])}function l(){r(e[5])}function u(){r(e[6])}function p(){r(e[7])}function f(){r(e[8])}function d(){r(e[9])}if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callBack required");if(this.choosePending)delete this.choosePending,r(i.firstMatch(this.chooseResponse,e));else{var m=[];if(m.push([{text:t.replace(/\n/g,"<br>"),label:!0}]),e.length>0&&m.push([{text:e[0],onClick:o}]),e.length>1&&m.push([{text:e[1],onClick:a}]),e.length>2&&m.push([{text:e[2],onClick:s}]),e.length>3&&m.push([{text:e[3],onClick:c}]),e.length>4&&m.push([{text:e[4],onClick:h}]),e.length>5&&m.push([{text:e[5],onClick:l}]),e.length>6&&m.push([{text:e[6],onClick:u}]),e.length>7&&m.push([{text:e[7],onClick:p}]),e.length>8&&m.push([{text:e[8],onClick:f}]),e.length>9&&m.push([{text:e[9],onClick:d}]),e.length>10)throw new Error("max choices reached in choose");m.push([{text:"Cancel",color:"red",onClick:n}]),A._f7.actions(m)}},A.prototype.htmlViews=function(){{var t=this,e=A.addEle;Dom7}t.pages=e(t.viewMain,"div","pages navbar-through toolbar-through",{id:"pages"}),t.dataPage=e(t.pages,"div","page",{id:"dataPage","data-page":"index"}),t.pageContent=e(t.dataPage,"div","page-content",{id:"pageContent"}),t.tabs=e(t.pageContent,"div","tabs",{id:"tabs"});var r=e(t.tabs,"div","tab active",{id:"starterPage"});e(r,"div","content-block-title").innerHTML=t.application.get("brand"),t.tempLog=e(r,"div","content-block"),t.tempLog.innerHTML="Touch the icons below to explore!"},A.prototype.showView=function(t){function e(e){function o(t){var e=t.command;switch(e.type){case"Function":case"Procedure":e.execute();break;case"Stub":r.application.ok("The "+e.name+" feature is not available.",function(){});break;default:r.application.ok("Sorry can't handle that command type yet\n\n"+JSON.stringify(e.type),function(){})}}for(var a=i(t.primaryView,"div","content-block"),s=i(a,"div","list-block"),c=0;c<e.length;c++){var h=e[c],l=i(s,"ul");if("string"==typeof h)"-"!=h&&(i(l,"p").innerHTML=h);else{var u={command:h,domElement:null,id:null};t.subMenu.push(u),u.id=t.id+"-"+t.subMenu.length;var p=i(l,"li");u.domElement=i(p,"a","item-link",{id:u.id,href:"#"});var f=i(u.domElement,"div","item-content"),d=i(f,"div","item-media"),m=i(f,"div","item-inner");i(d,"i","fa "+(h.icon||"fa-beer")+" fa-lg"),i(m,"div","item-title").innerHTML=h.name,n("#"+u.id).on("click",function(){var t=n(this).attr("id"),e=t.indexOf("-")+1,i=q(t,e-1),a=parseInt(B(i,i.length-6))-1,s=parseInt(B(t,t.length-e))-1;o(r.toolBarCommands[a].subMenu[s])})}}}var r=this,i=A.addEle,n=Dom7,o=t.command;if(!t.primaryView)switch(t.primaryView=i(r.tabs,"div","tab"),o.type){case"Menu":e(t.command.contents);break;default:i(t.primaryView,"div","content-block-title").innerHTML=t.command.name,t.primaryViewBlock=i(t.primaryView,"div","content-block"),t.primaryViewBlock.innerHTML=JSON.stringify(t.command)}r.activateView(t.primaryView),r.updateBrand(o.name),r.highlightToolBarCommand(t)},A.prototype.activateView=function(t){var e=Dom7;e("#starterPage").removeClass("active");for(var r=0;r<this.toolBarCommands.length;r++){var i=this.toolBarCommands[r];e(i.primaryView).removeClass("active")}e(t).addClass("active")},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports.TGI=h):c.TGI=h}).call(this);